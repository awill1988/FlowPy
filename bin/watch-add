#!/usr/bin/env bash
# don't continue when there's an unexpected error or for undefined variables
set -eu

# to know where this script lives on the filesystem when it is run
rootdir=$(cd "$(dirname "$0")/../"; pwd -P)

# load helper bash functions
source "${rootdir}/bin/rc"

# make sure watchman is installed
type watchman >/dev/null || die 'watchman is not installed. See https://facebook.github.io/watchman/docs/install.html'

#--------------------------------------------------------------------
#                         watchman(add)
#--------------------------------------------------------------------
#   watches the source files for changes and rebuilds debug release
#--------------------------------------------------------------------
watchman watch "${rootdir}/src"

watchman -j <<-EOT
[
    "trigger",
    "${rootdir}/src",
    {
    "name": "build-on-change",
    "expression": ["pcre", ".*\\\.py$", "basename"],
    "command": ["${rootdir}/.venv3.10/bin/pip", "install", ".."]
    }
]
EOT
